<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Paper.js Operator Bounding Box</title>
    <!-- Paper.js -->
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/paper.js/0.12.15/paper-full.min.js"
      integrity="sha512-ovjLI1ZcZe6bw+ImQ21r+sv8q/Vwob2kq7tFidK6E1LWfi0T4uobbmpfEU1//a9h9o5Kkt+MnMWf6rWlg0EiMw=="
      crossorigin="anonymous"
    ></script>
    <style>
      #container {
        position: relative;
        display: inline-block;
      }

      #img {
        display: block;
        width: 100%;
        height: auto;
      }

      #myCanvas {
        position: absolute;
        top: 0;
        left: 0;
        z-index: 10;
        pointer-events: none;
      }

      .label {
        position: absolute;
        font-size: 12px;
        padding: 2px 4px;
        font-family: sans-serif;
        border-radius: 3px;
        z-index: 1;
      }
    </style>
  </head>
  <body>
    <div id="container">
      <img
        id="img"
        src="https://storage.googleapis.com/tqv-prd-ssb01-data/friends/dp4cam01_ssb01_prd/video0/table5_l_operator/annotated/2025/05/13/13/c4aac411406f_video0_1747143369.0_table5_l_operator_annotated.jpg?X-Goog-Algorithm=GOOG4-RSA-SHA256&X-Goog-Credential=portal-storage%40prod1-svc-rbzn.iam.gserviceaccount.com%2F20250513%2Fauto%2Fstorage%2Fgoog4_request&X-Goog-Date=20250513T155214Z&X-Goog-Expires=1200&X-Goog-SignedHeaders=host&X-Goog-Signature=11f5c6aa7cd9214922a74aed2e22665fbf2b3de877cdeef77064ca6da7375197ecce5ae96400956f0c7ecdaabc5b8305a4fa0820d9fb172790692a60e17c32f272e7a955b5e6e0c182be18c50d6a03322dbe4a025d54ecace8ae86c8ce5b71a9aa6797c44a0d23c1b2cd26ca6cf82ccf3cbb73016a78f734ee0766bf8b6fbc44e7c943e7a36031d862948bec2400d2a8569d6a0f7076b4de56bf4b2f21995d08d68f0b9b0be77ec300722ea46c6889bc0ccbe16df0569c896d99f109c2d9f91c4b2f333459c4119d02cb14120a7af268c9218997f49edf9d012bf463c227e3d485de72ac74f75964c97ca545e6fd57ab3e2eed431500686d66ebac57f51ec21d"
        onload="initBoundingBoxes()"
      />
      <canvas id="myCanvas"></canvas>
    </div>

    <script type="text/javascript">
      const bboxes = {
        operator: [[62, 223, 76, 68, 0.9999785423278809]],
        person: [
          [201, 337, 108, 87, 0.9999704360961914],
          [363, 147, 63, 86, 0.9978601336479187],
          [53, 395, 73, 97, 0.9558233618736267],
        ],
      };

      // Функція для малювання фреймів
      function drawBoundingBox([x, y, width, height], color, labelText) {
        new paper.Path.Rectangle({
          rectangle: new paper.Rectangle(x, y, width, height),
          strokeColor: color,
          strokeWidth: 2,
        });

        const label = document.createElement("div");
        label.className = "label";
        label.textContent = labelText;
        label.style.left = `${x}px`;
        label.style.top = `${y - 18}px`;
        label.style.backgroundColor = color;
        document.getElementById("container").appendChild(label);
      }

      // Ініціалізація фреймів на завантаженій картинці
      function initBoundingBoxes() {
        const img = document.getElementById("img");
        const canvas = document.getElementById("myCanvas");

        // Синхронізуємо розміри canvas з розмірами картинки
        canvas.width = img.width;
        canvas.height = img.height;
        console.log(img.width, img.height);

        paper.setup(canvas);

        // Масштабування координат
        const imgWidth = img.naturalWidth;
        const imgHeight = img.naturalHeight;

        const scaleX = img.width / imgWidth;
        const scaleY = img.height / imgHeight;

        // Масштабуємо фрейми
        bboxes.operator.forEach((box) => {
          const [x, y, width, height] = box.slice(0, 4);
          drawBoundingBox(
            [x * scaleX, y * scaleY, width * scaleX, height * scaleY],
            "deepskyblue",
            "operator"
          );
        });
        bboxes.person.forEach((box) => {
          const [x, y, width, height] = box.slice(0, 4);
          drawBoundingBox(
            [x * scaleX, y * scaleY, width * scaleX, height * scaleY],
            "deepskyblue",
            "person"
          );
        });

        paper.view.draw();
      }

      // Оновлення фреймів при зміні розміру картинки
      window.addEventListener("resize", () => {
        initBoundingBoxes();
      });
    </script>
  </body>
</html>
